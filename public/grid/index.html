<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>Motor Settings</title>
<link rel="stylesheet" href="css/backgrid-0.3.5.css">
<link rel="stylesheet" href="css/backgrid-select-all.css">
<link rel="stylesheet" href="css/backgrid-paginator.css">
<link rel="stylesheet" href="css/backgrid-filter.css">
</head>
<body>
<h1>Motor Settings</h1>
<div>
  <button id="add_btn">Add New</button>
  <button id="save_btn">Save</button>
  <button id="delete_btn">Deleted Selected</button>
</div>
<div id="grid" class="backgrid-container"></div>
<script src="js/jquery-1.11.0.js"></script>
<script src="js/underscore-1.6.0.js"></script>
<script src="js/backbone-1.1.2.js"></script>
<script src="js/backbone-pageable.js"></script>
<script src="js/backgrid-0.3.5.js"></script>
<script src="js/backgrid-select-all.js"></script>
<script src="js/backgrid-paginator.js"></script>
<script src="js/backgrid-filter.js"></script>
<script>
$(function() {

Motor = Backbone.Model.extend({});

var columns = [{
    name: "name",
    label: "Name",
    // The cell type can be a reference of a Backgrid.Cell subclass, any Backgrid.Cell subclass instances like *id* above, or a string
    cell: "string" // This is converted to "StringCell" and a corresponding class in the Backgrid package namespace is looked up
  },
  {
      name: "group",
      label: "Group",
      cell: "string" 
  },
  {
      name: "sort_no",
      label: "Sort NO",
      cell: "string" 
  },
  {
      name: "hardware",
      label: "Hardware",
      cell: "string" 
  },
  {
      name: "motor_id",
      label: "Motor ID",
      cell: "integer" 
  },
  {
      name: "topic",
      label: "Topic",
      cell: "string" 
  },
  {
      name: "min",
      label: "Min",
      cell: "integer" 
  },
  {
      name: "init",
      label: "Init",
      cell: "integer" 
  },
  {
      name: "max",
      label: "Max",
      cell: "integer" 
  },
  {
      name: "speed",
      label: "Speed",
      cell: "number" 
  },
  {
      name: "acceleration",
      label: "Acceleration",
      cell: "number" 
  },
  {
      name: "parser",
      label: "Parser",
      cell: "string" 
  },
  {
      name: "parser_param",
      label: "Param",
      cell: "string" 
  },
  {
      name: "function",
      label: "Function",
      cell: Backgrid.SelectCell.extend({
        optionValues: [['Weighted Sum', 'weightedsum'], ['Linear', 'linear'],['Other','']]
      })
  },
  {
      name: "lin_min",
      label: "Linear Min",
      cell: "number" 
  },
  {
      name: "lin_max",
      label: "Linear Max",
      cell: "number" 
  },
  {
      name: "imin",
      label: "Name",
      cell: "string",
      editable: false
  },
  {
      name: "max1",
      label: "Max1",
      cell: "number" 
  },
  {
      name: "imax1",
      label: "imax1",
      cell: "number" 
  },
  {
      name: "max2",
      label: "Max2",
      cell: "number" 
  },
  {
      name: "imax2",
      label: "Imax2",
      cell: "number" 
  },
  {
      name: "other_func",
      label: "Other Func (in JSON)",
      cell: "string" 
  }
  ];

var PageableMotors = Backbone.PageableCollection.extend({
  model: Motor,
  url: "/motors/get/han",
  state: {
    pageSize: 50
  },
  mode: "client", // page entirely on the client side
  save: function (errorCallback) {
      var data = [];
      this.each(function (motor) {
        motor = motor.toJSON();
        data.push(motor);
      });

      $.ajax("/motors/update" + "/han", {
          data: JSON.stringify(data),
          type: 'POST',
          dataType: "json",
          success: function (data) {
              if (data.error){
                alert(data.error);
              }
          },
          error: function () {
              if (typeof errorCallback == 'function')
                  errorCallback();
          }
      });
  }
});

var pageableMotors = new PageableMotors();

// Set up a grid to use the pageable collection
pageableGrid = new Backgrid.Grid({
  columns: [{
    // enable the select-all extension
    name: "",
    cell: "select-row",
    headerCell: "select-all"
  }].concat(columns),
  collection: pageableMotors
});

// Render the grid
var $example2 = $("#grid");
$example2.append(pageableGrid.render().el)

// Initialize the paginator
var paginator = new Backgrid.Extension.Paginator({
  collection: pageableMotors
});

// Render the paginator
$example2.after(paginator.render().el);

// Initialize a client-side filter to filter on the client
// mode pageable collection's cache.
var filter = new Backgrid.Extension.ClientSideFilter({
  collection: pageableMotors,
  fields: ['name']
});

// Render the filter
$example2.before(filter.render().el);

// Add some space to the filter and move it to the right
$(filter.el).css({float: "right", margin: "20px"});

// Fetch some data
pageableMotors.fetch({reset: true});

// Controls
$('#add_btn').click(function(){
  pageableGrid.insertRow({name: "New"})
});
$('#save_btn').click(function(){
  pageableMotors.save();
});

$('#delete_btn').click(function(){
  $.each(pageableGrid.getSelectedModels(), function(i,e){pageableGrid.removeRow(e); });
});


});
</script>
<button>
</body>
</html>
